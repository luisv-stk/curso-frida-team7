<div class="container-fluid min-vh-100 d-flex flex-column" style="background-color: #190421;">
  <div class="d-flex justify-content-end p-3">
    <button class="btn btn-outline-primary text-white border-0">EN</button>
    <button class="btn btn-outline-primary text-white border-0 mx-2">{{ user }} <mat-icon>arrow_drop_down</mat-icon></button>
    <button class="btn btn-outline-primary text-white border-0">
      <mat-icon>notifications_none</mat-icon>
    </button>
  </div>
  <div class="d-flex flex-grow-1">
    <div class="d-flex flex-column p-5 text-white" style="width: 40%;">
      <h2 class="fw-bold">Crea tu propio banco de imágenes personalizado</h2>
      <p>Nuestro gestor de imágenes con IA facilitará:</p>
      <input type="text" class="form-control my-3" placeholder="Buscar" style="max-width: 300px;">
      <button class="btn btn-outline-primary w-50 mb-2">Descargar</button>
      <button class="btn btn-outline-primary w-50">Clasificar</button>
      <div class="mt-4">
        <!-- Primera fila: primeras 3 imágenes -->
        <div class="d-flex mb-2">
          <ng-container *ngFor="let category of imageCategories.slice(0, 3)">
            <img *ngFor="let image of category.images" [src]="image" class="img-thumbnail me-2" style="width: 100px; height: 100px; object-fit: cover;">
          </ng-container>
        </div>
        <!-- Segunda fila: últimas 3 imágenes -->
        <div class="d-flex">
          <ng-container *ngFor="let category of imageCategories.slice(3, 6)">
            <img *ngFor="let image of category.images" [src]="image" class="img-thumbnail me-2" style="width: 100px; height: 100px; object-fit: cover;">
          </ng-container>
        </div>
      </div>
    </div>
    <div class="flex-fill p-5 text-white" style="background-color: #391d4e; border-radius: 25px; margin: 20px;">
      <!-- Category Selection -->
      <div class="mb-4">
        <label for="categorySelect" class="form-label" style="color: #ff75f8;">Seleccionar categoría para nuevas imágenes:</label>
        <select id="categorySelect" class="form-select" [(ngModel)]="selectedCategory" style="max-width: 300px; background-color: #2d1b3d; color: white; border-color: #ff11f2;">
          <option value="">Sin categoría</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Drop Area -->
      <div
        class="drop-area d-flex flex-column justify-content-center align-items-center text-center position-relative mb-4"
        [class.drag-over]="isDragOver"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="onDropAreaClick()"
        style="border: 2px dashed #ff11f2; border-radius: 10px; min-height: 200px; cursor: pointer; background-color: #2d1b3d;">

        <input
          #fileInput
          type="file"
          multiple
          accept="image/*"
          style="display: none;"
          (change)="onFileSelected($event)">

        <mat-icon style="font-size: 48px; height: 48px; width: 48px; color: #ff11f2;">cloud_upload</mat-icon>
        <p class="mb-0 mt-3" style="color: #ff75f8;">Arrastra varias imágenes aquí</p>
        <p class="mb-0" style="color: #ff75f8;">(o haz clic para seleccionar)</p>
      </div>

      <!-- Upload Button -->
      <div class="text-center mb-4">
        <button
          class="btn btn-primary"
          (click)="onDropAreaClick()"
          [disabled]="isUploading"
          style="background-color: #ff11f2; border-color: #ff11f2; padding: 10px 40px;">
          <mat-icon *ngIf="!isUploading" style="vertical-align: middle;">add_photo_alternate</mat-icon>
          <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isUploading ? 'Subiendo...' : 'Subir Imágenes' }}
        </button>
      </div>

      <!-- Uploaded Images Grid -->
      <div *ngIf="uploadedImages.length > 0" class="mt-4">
        <h5 style="color: #ff75f8;">Imágenes Subidas ({{ uploadedImages.length }})</h5>

        <!-- Bulk Actions -->
        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-sm btn-outline-light" (click)="selectAllImages()">
            {{ isSelectAllMode ? 'Deseleccionar Todo' : 'Seleccionar Todo' }}
          </button>
          <button class="btn btn-sm btn-outline-danger" (click)="deleteSelectedImages()" [disabled]="selectedImageCount === 0">
            Eliminar Seleccionadas ({{ selectedImageCount }})
          </button>
        </div>

        <!-- Images Grid -->
        <div class="row g-3">
          <div *ngFor="let image of uploadedImages; let i = index" class="col-md-3">
            <div class="card" style="background-color: #2d1b3d; border-color: #ff11f2;">
              <div class="position-relative">
                <img [src]="image.previewUrl" class="card-img-top" style="height: 150px; object-fit: cover;" [alt]="image.filename">
                <div class="position-absolute top-0 end-0 p-2">
                  <input
                    type="checkbox"
                    [checked]="image.selected"
                    (change)="toggleImageSelection(i)"
                    class="form-check-input">
                </div>
              </div>
              <div class="card-body p-2">
                <p class="card-text small text-truncate mb-1" style="color: white;">{{ image.filename }}</p>
                <p class="card-text small mb-1" style="color: #ff75f8;">{{ formatFileSize(image.size) }}</p>
                <select
                  class="form-select form-select-sm mt-2"
                  [(ngModel)]="image.category"
                  style="background-color: #190421; color: white; border-color: #ff11f2;">
                  <option value="">Sin categoría</option>
                  <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                </select>
                <button class="btn btn-sm btn-danger w-100 mt-2" (click)="removeImage(i)">
                  Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div *ngIf="isUploading" class="text-center mt-4">
        <div class="spinner-border text-light" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2" style="color: #ff75f8;">Procesando imágenes...</p>
      </div>
    </div>
  </div>
</div>
